"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[822],{67733:function(ce,p,t){var X=t(20596),L=t(49978),J=t(44330),W=t(17400),k=t(29079),l=t(19041),q=t(30606),F=t(61343),ee=t(90537),te=t(72434),U=t(88100),j=t(85563),H=t(42028),Y=t(61463),R=t(46175),ne=t(93802),re=t(77511),w=t(96619),z=t(3494),f=t(38497),ae=t(2221),c=t(96469),le=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],oe=["record","position","creatorButtonText","newRecordType","parentKey","style"],Q=f.createContext(void 0);function g(e){var E=e.children,T=e.record,D=e.position,M=e.newRecordType,_=e.parentKey,B=(0,f.useContext)(Q);return f.cloneElement(E,(0,l.Z)((0,l.Z)({},E.props),{},{onClick:function(){var O=(0,k.Z)((0,W.Z)().mark(function $(y){var C,u,m,h;return(0,W.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(C=(u=E.props).onClick)===null||C===void 0?void 0:C.call(u,y);case 2:if(h=i.sent,h!==!1){i.next=5;break}return i.abrupt("return");case 5:B==null||(m=B.current)===null||m===void 0||m.addEditRecord(T,{position:D,newRecordType:M,parentKey:_});case 6:case"end":return i.stop()}},$)}));function b($){return O.apply(this,arguments)}return b}()}))}function x(e){var E,T,D=(0,te.YB)(),M=e.onTableChange,_=e.maxLength,B=e.formItemProps,O=e.recordCreatorProps,b=e.rowKey,$=e.controlled,y=e.defaultValue,C=e.onChange,u=e.editableFormRef,m=(0,J.Z)(e,le),h=(0,f.useRef)(void 0),I=(0,f.useRef)(),i=(0,f.useRef)();(0,f.useImperativeHandle)(m.actionRef,function(){return I.current},[I.current]);var V=(0,re.Z)(function(){return e.value||y||[]},{value:e.value,onChange:e.onChange}),se=(0,L.Z)(V,2),d=se[0],fe=se[1],A=f.useMemo(function(){return typeof b=="function"?b:function(n,v){return n[b]||v}},[b]),ie=(0,U.J)(function(n){if(typeof n=="number"&&!e.name){if(n>=d.length)return n;var v=d&&d[n];return A==null?void 0:A(v,n)}if((typeof n=="string"||n>=d.length)&&e.name){var r=d.findIndex(function(a,o){var s;return(A==null||(s=A(a,o))===null||s===void 0?void 0:s.toString())===(n==null?void 0:n.toString())});if(r!==-1)return r}return n});(0,f.useImperativeHandle)(u,function(){var n=function(a){var o,s;if(a==null)throw new Error("rowIndex is required");var P=ie(a),K=[e.name,(o=P==null?void 0:P.toString())!==null&&o!==void 0?o:""].flat(1).filter(Boolean);return(s=i.current)===null||s===void 0?void 0:s.getFieldValue(K)},v=function(){var a,o=[e.name].flat(1).filter(Boolean);if(Array.isArray(o)&&o.length===0){var s,P=(s=i.current)===null||s===void 0?void 0:s.getFieldsValue();return Array.isArray(P)?P:Object.keys(P).map(function(K){return P[K]})}return(a=i.current)===null||a===void 0?void 0:a.getFieldValue(o)};return(0,l.Z)((0,l.Z)({},i.current),{},{getRowData:n,getRowsData:v,setRowData:function(a,o){var s,P;if(a==null)throw new Error("rowIndex is required");var K=ie(a),G=[e.name,(s=K==null?void 0:K.toString())!==null&&s!==void 0?s:""].flat(1).filter(Boolean),_e=Object.assign({},(0,l.Z)((0,l.Z)({},n(a)),o||{})),xe=(0,z.Z)({},G,_e);return(P=i.current)===null||P===void 0||P.setFieldsValue(xe),!0}})},[ie,e.name,i.current]),(0,f.useEffect)(function(){e.controlled&&(d||[]).forEach(function(n,v){var r;(r=i.current)===null||r===void 0||r.setFieldsValue((0,X.Z)({},"".concat(A(n,v)),n))},{})},[(0,j.ZP)(d),e.controlled]),(0,f.useEffect)(function(){if(e.name){var n;i.current=e==null||(n=e.editable)===null||n===void 0?void 0:n.form}},[(E=e.editable)===null||E===void 0?void 0:E.form,e.name]);var S=O||{},me=S.record,de=S.position,he=S.creatorButtonText,ge=S.newRecordType,Pe=S.parentKey,Ee=S.style,ye=(0,J.Z)(S,oe),ve=de==="top",N=(0,f.useMemo)(function(){return typeof _=="number"&&_<=(d==null?void 0:d.length)?!1:O!==!1&&(0,c.jsx)(g,{record:(0,H.h)(me,d==null?void 0:d.length,d)||{},position:de,parentKey:(0,H.h)(Pe,d==null?void 0:d.length,d),newRecordType:ge,children:(0,c.jsx)(R.ZP,(0,l.Z)((0,l.Z)({type:"dashed",style:(0,l.Z)({display:"block",margin:"10px 0",width:"100%"},Ee),icon:(0,c.jsx)(q.Z,{})},ye),{},{children:he||D.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[O,_,d==null?void 0:d.length]),Ce=(0,f.useMemo)(function(){return N?ve?{components:{header:{wrapper:function(v){var r,a=v.className,o=v.children;return(0,c.jsxs)("thead",{className:a,children:[o,(0,c.jsxs)("tr",{style:{position:"relative"},children:[(0,c.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:N}),(0,c.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(r=m.columns)===null||r===void 0?void 0:r.length,children:N})]})]})}}}}:{tableViewRender:function(v,r){var a,o;return(0,c.jsxs)(c.Fragment,{children:[(a=(o=e.tableViewRender)===null||o===void 0?void 0:o.call(e,v,r))!==null&&a!==void 0?a:r,N]})}}:{}},[ve,N]),ue=(0,l.Z)({},e.editable),Re=(0,U.J)(function(n,v){var r,a,o;if((r=e.editable)===null||r===void 0||(a=r.onValuesChange)===null||a===void 0||a.call(r,n,v),(o=e.onValuesChange)===null||o===void 0||o.call(e,v,n),e.controlled){var s;e==null||(s=e.onChange)===null||s===void 0||s.call(e,v)}});return(e!=null&&e.onValuesChange||(T=e.editable)!==null&&T!==void 0&&T.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(ue.onValuesChange=Re),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Q.Provider,{value:I,children:(0,c.jsx)(ae.Z,(0,l.Z)((0,l.Z)((0,l.Z)({search:!1,options:!1,pagination:!1,rowKey:b,revalidateOnFocus:!1},m),Ce),{},{tableLayout:"fixed",actionRef:I,onChange:M,editable:(0,l.Z)((0,l.Z)({},ue),{},{formProps:(0,l.Z)({formRef:i},ue.formProps)}),dataSource:d,onDataSourceChange:function(v){if(fe(v),e.name&&de==="top"){var r,a=(0,z.Z)({},[e.name].flat(1).filter(Boolean),v);(r=i.current)===null||r===void 0||r.setFieldsValue(a)}}}))}),e.name?(0,c.jsx)(F.Z,{name:[e.name],children:function(v){var r,a;if(!h.current)return h.current=d,null;var o=(0,w.Z)(v,[e.name].flat(1)),s=o==null?void 0:o.find(function(P,K){var G;return!(0,Y.A)(P,(G=h.current)===null||G===void 0?void 0:G[K])});return h.current=d,s&&(e==null||(r=e.editable)===null||r===void 0||(a=r.onValuesChange)===null||a===void 0||a.call(r,s,o)),null}}):null]})}function Z(e){var E=ee.ZP.useFormInstance();return e.name?(0,c.jsx)(ne.Z.Item,(0,l.Z)((0,l.Z)({style:{maxWidth:"100%"},shouldUpdate:function(D,M){var _=[e.name].flat(1);try{return JSON.stringify((0,w.Z)(D,_))!==JSON.stringify((0,w.Z)(M,_))}catch(B){return!0}}},e==null?void 0:e.formItemProps),{},{name:e.name,children:(0,c.jsx)(x,(0,l.Z)((0,l.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},e),{},{editable:(0,l.Z)((0,l.Z)({},e.editable),{},{form:E})}))})):(0,c.jsx)(x,(0,l.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},e))}Z.RecordCreator=g,p.Z=Z},51818:function(ce,p,t){t.r(p),t.d(p,{default:function(){return Q}});var X=t(43953),L=t.n(X),J=t(91184),W=t.n(J),k=t(9083),l=t.n(k),q=t(67733),F=t(19041),ee=t(44330),te=t(42028),U=t(72248),j=t(38497),H=t(43126),Y=t(94271),R=t(96469),ne=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],re=j.forwardRef(function(g,x){var Z=g.fieldProps,e=g.options,E=g.radioType,T=g.layout,D=g.proFieldProps,M=g.valueEnum,_=(0,ee.Z)(g,ne);return(0,R.jsx)(Y.Z,(0,F.Z)((0,F.Z)({valueType:E==="button"?"radioButton":"radio",ref:x,valueEnum:(0,te.h)(M,void 0)},_),{},{fieldProps:(0,F.Z)({options:e,layout:T},Z),proFieldProps:D,filedConfig:{customLightMode:!0}}))}),w=j.forwardRef(function(g,x){var Z=g.fieldProps,e=g.children;return(0,R.jsx)(U.ZP,(0,F.Z)((0,F.Z)({},Z),{},{ref:x,children:e}))}),z=(0,H.G)(w,{valuePropName:"checked",ignoreWidth:!0}),f=z;f.Group=re,f.Button=U.ZP.Button,f.displayName="ProFormComponent";var ae=f,c=t(1118),le=function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(Z){setTimeout(function(){Z(!0)},x)})},oe=[{id:624748504,title:"\u6D3B\u52A8\u540D\u79F0\u4E00",readonly:"\u6D3B\u52A8\u540D\u79F0\u4E00",decs:"\u8FD9\u4E2A\u6D3B\u52A8\u771F\u597D\u73A9",state:"open",created_at:1590486176e3,update_at:1590486176e3},{id:624691229,title:"\u6D3B\u52A8\u540D\u79F0\u4E8C",readonly:"\u6D3B\u52A8\u540D\u79F0\u4E8C",decs:"\u8FD9\u4E2A\u6D3B\u52A8\u771F\u597D\u73A9",state:"closed",created_at:1590481162e3,update_at:1590481162e3}],Q=function(){var g=(0,j.useState)([]),x=l()(g,2),Z=x[0],e=x[1],E=(0,j.useState)([]),T=l()(E,2),D=T[0],M=T[1],_=(0,j.useState)("bottom"),B=l()(_,2),O=B[0],b=B[1],$=[{title:"\u6D3B\u52A8\u540D\u79F0",dataIndex:"title",tooltip:"\u53EA\u8BFB\uFF0C\u4F7F\u7528form.getFieldValue\u83B7\u53D6\u4E0D\u5230\u503C",formItemProps:function(C,u){var m=u.rowIndex;return{rules:m>1?[{required:!0,message:"\u6B64\u9879\u4E3A\u5FC5\u586B\u9879"}]:[]}},editable:function(C,u,m){return m!==0},width:"15%"},{title:"\u6D3B\u52A8\u540D\u79F0\u4E8C",dataIndex:"readonly",tooltip:"\u53EA\u8BFB\uFF0C\u4F7F\u7528form.getFieldValue\u53EF\u4EE5\u83B7\u53D6\u5230\u503C",readonly:!0,width:"15%"},{title:"\u72B6\u6001",key:"state",dataIndex:"state",valueType:"select",valueEnum:{all:{text:"\u5168\u90E8",status:"Default"},open:{text:"\u672A\u89E3\u51B3",status:"Error"},closed:{text:"\u5DF2\u89E3\u51B3",status:"Success"}}},{title:"\u63CF\u8FF0",dataIndex:"decs",fieldProps:function(C,u){var m=u.rowKey,h=u.rowIndex;return C.getFieldValue([m||"","title"])==="\u4E0D\u597D\u73A9"?{disabled:!0}:h>9?{disabled:!0}:{}}},{title:"\u6D3B\u52A8\u65F6\u95F4",dataIndex:"created_at",valueType:"date"},{title:"\u64CD\u4F5C",valueType:"option",width:200,render:function(C,u,m,h){return[(0,R.jsx)("a",{onClick:function(){var i;h==null||(i=h.startEditable)===null||i===void 0||i.call(h,u.id)},children:"\u7F16\u8F91"},"editable"),(0,R.jsx)("a",{onClick:function(){M(D.filter(function(i){return i.id!==u.id}))},children:"\u5220\u9664"},"delete")]}}];return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(q.Z,{rowKey:"id",headerTitle:"\u53EF\u7F16\u8F91\u8868\u683C",maxLength:5,scroll:{x:960},recordCreatorProps:O!=="hidden"?{position:O,record:function(){return{id:(Math.random()*1e6).toFixed(0)}}}:!1,loading:!1,toolBarRender:function(){return[(0,R.jsx)(ae.Group,{fieldProps:{value:O,onChange:function(u){return b(u.target.value)}},options:[{label:"\u6DFB\u52A0\u5230\u9876\u90E8",value:"top"},{label:"\u6DFB\u52A0\u5230\u5E95\u90E8",value:"bottom"},{label:"\u9690\u85CF",value:"hidden"}]},"render")]},defaultData:[{id:"id",title:"title",readonly:"con",decs:"decs",state:"success"}],columns:$,request:W()(L()().mark(function y(){return L()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",{data:oe,total:3,success:!0});case 1:case"end":return u.stop()}},y)})),value:D,onChange:M,editable:{type:"multiple",editableKeys:Z,onSave:function(){var y=W()(L()().mark(function u(m,h,I){return L()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return console.log(m,h,I),V.next=3,le(2e3);case 3:case"end":return V.stop()}},u)}));function C(u,m,h){return y.apply(this,arguments)}return C}(),onChange:e}}),(0,R.jsx)(c.Z,{title:"\u8868\u683C\u6570\u636E",headerBordered:!0,collapsible:!0,defaultCollapsed:!0,children:(0,R.jsx)(Y.Z,{ignoreFormItem:!0,fieldProps:{style:{width:"100%"}},mode:"read",valueType:"jsonCode",text:JSON.stringify(D)})})]})}}}]);
