"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[463],{75092:function(De,te,t){var re=t(19766),E=t(53789),J=t(72667),ae=t(77511),ie=t(63974),d=t(24382),de=t(61060),W=t(38497),H=t(14959),g=t(96469),j=["fieldProps","proFieldProps"],le=["fieldProps","proFieldProps"],S="text",Q=function(h){var a=h.fieldProps,R=h.proFieldProps,v=(0,J.Z)(h,j);return(0,g.jsx)(H.Z,(0,E.Z)({valueType:S,fieldProps:a,filedConfig:{valueType:S},proFieldProps:R},v))},O=function(h){var a=(0,ae.Z)(h.open||!1,{value:h.open,onChange:h.onOpenChange}),R=(0,re.Z)(a,2),v=R[0],k=R[1];return(0,g.jsx)(ie.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(U){var b,F=U.getFieldValue(h.name||[]);return(0,g.jsx)(d.Z,(0,E.Z)((0,E.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return k(e)},content:(0,g.jsxs)("div",{style:{padding:"4px 0"},children:[(b=h.statusRender)===null||b===void 0?void 0:b.call(h,F),h.strengthText?(0,g.jsx)("div",{style:{marginTop:10},children:(0,g.jsx)("span",{children:h.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},h.popoverProps),{},{open:v,children:h.children}))}})},oe=function(h){var a=h.fieldProps,R=h.proFieldProps,v=(0,J.Z)(h,le),k=(0,W.useState)(!1),u=(0,re.Z)(k,2),U=u[0],b=u[1];return a!=null&&a.statusRender&&v.name?(0,g.jsx)(O,{name:v.name,statusRender:a==null?void 0:a.statusRender,popoverProps:a==null?void 0:a.popoverProps,strengthText:a==null?void 0:a.strengthText,open:U,onOpenChange:b,children:(0,g.jsx)("div",{children:(0,g.jsx)(H.Z,(0,E.Z)({valueType:"password",fieldProps:(0,E.Z)((0,E.Z)({},(0,de.Z)(a,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(T){var e;a==null||(e=a.onBlur)===null||e===void 0||e.call(a,T),b(!1)},onClick:function(T){var e;a==null||(e=a.onClick)===null||e===void 0||e.call(a,T),b(!0)}}),proFieldProps:R,filedConfig:{valueType:S}},v))})}):(0,g.jsx)(H.Z,(0,E.Z)({valueType:"password",fieldProps:a,proFieldProps:R,filedConfig:{valueType:S}},v))},Y=Q;Y.Password=oe,Y.displayName="ProFormComponent",te.Z=Y},62067:function(De,te,t){var re=t(10331),E=t(19766),J=t(72667),ae=t(97620),ie=t(70727),d=t(53789),de=t(30606),W=t(52863),H=t(14723),g=t(91321),j=t(13157),le=t(26812),S=t(95290),Q=t(32821),O=t(79853),oe=t(63974),Y=t(77511),C=t(96619),h=t(3494),a=t(38497),R=t(32115),v=t(96469),k=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],u=["record","position","creatorButtonText","newRecordType","parentKey","style"],U=a.createContext(void 0);function b(e){var x=e.children,w=e.record,$=e.position,V=e.newRecordType,Z=e.parentKey,X=(0,a.useContext)(U);return a.cloneElement(x,(0,d.Z)((0,d.Z)({},x.props),{},{onClick:function(){var N=(0,ie.Z)((0,ae.Z)().mark(function se(_e){var q,ee,y,p;return(0,ae.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(q=(ee=x.props).onClick)===null||q===void 0?void 0:q.call(ee,_e);case 2:if(p=P.sent,p!==!1){P.next=5;break}return P.abrupt("return");case 5:X==null||(y=X.current)===null||y===void 0||y.addEditRecord(w,{position:$,newRecordType:V,parentKey:Z});case 6:case"end":return P.stop()}},se)}));function B(se){return N.apply(this,arguments)}return B}()}))}function F(e){var x,w,$=(0,g.YB)(),V=e.onTableChange,Z=e.maxLength,X=e.formItemProps,N=e.recordCreatorProps,B=e.rowKey,se=e.controlled,_e=e.defaultValue,q=e.onChange,ee=e.editableFormRef,y=(0,J.Z)(e,k),p=(0,a.useRef)(void 0),z=(0,a.useRef)(),P=(0,a.useRef)();(0,a.useImperativeHandle)(y.actionRef,function(){return z.current},[z.current]);var Ce=(0,Y.Z)(function(){return e.value||_e||[]},{value:e.value,onChange:e.onChange}),A=(0,E.Z)(Ce,2),m=A[0],ve=A[1],I=a.useMemo(function(){return typeof B=="function"?B:function(n,i){return n[B]||i}},[B]),ce=(0,j.J)(function(n){if(typeof n=="number"&&!e.name){if(n>=m.length)return n;var i=m&&m[n];return I==null?void 0:I(i,n)}if((typeof n=="string"||n>=m.length)&&e.name){var r=m.findIndex(function(o,l){var f;return(I==null||(f=I(o,l))===null||f===void 0?void 0:f.toString())===(n==null?void 0:n.toString())});if(r!==-1)return r}return n});(0,a.useImperativeHandle)(ee,function(){var n=function(o){var l,f;if(o==null)throw new Error("rowIndex is required");var _=ce(o),M=[e.name,(l=_==null?void 0:_.toString())!==null&&l!==void 0?l:""].flat(1).filter(Boolean);return(f=P.current)===null||f===void 0?void 0:f.getFieldValue(M)},i=function(){var o,l=[e.name].flat(1).filter(Boolean);if(Array.isArray(l)&&l.length===0){var f,_=(f=P.current)===null||f===void 0?void 0:f.getFieldsValue();return Array.isArray(_)?_:Object.keys(_).map(function(M){return _[M]})}return(o=P.current)===null||o===void 0?void 0:o.getFieldValue(l)};return(0,d.Z)((0,d.Z)({},P.current),{},{getRowData:n,getRowsData:i,setRowData:function(o,l){var f,_;if(o==null)throw new Error("rowIndex is required");var M=ce(o),L=[e.name,(f=M==null?void 0:M.toString())!==null&&f!==void 0?f:""].flat(1).filter(Boolean),Oe=Object.assign({},(0,d.Z)((0,d.Z)({},n(o)),l||{})),Me=(0,h.Z)({},L,Oe);return(_=P.current)===null||_===void 0||_.setFieldsValue(Me),!0}})},[ce,e.name,P.current]),(0,a.useEffect)(function(){e.controlled&&(m||[]).forEach(function(n,i){var r;(r=P.current)===null||r===void 0||r.setFieldsValue((0,re.Z)({},"".concat(I(n,i)),n))},{})},[(0,le.ZP)(m),e.controlled]),(0,a.useEffect)(function(){if(e.name){var n;P.current=e==null||(n=e.editable)===null||n===void 0?void 0:n.form}},[(x=e.editable)===null||x===void 0?void 0:x.form,e.name]);var K=N||{},me=K.record,ne=K.position,fe=K.creatorButtonText,he=K.newRecordType,Ee=K.parentKey,D=K.style,Pe=(0,J.Z)(K,u),ue=ne==="top",G=(0,a.useMemo)(function(){return typeof Z=="number"&&Z<=(m==null?void 0:m.length)?!1:N!==!1&&(0,v.jsx)(b,{record:(0,S.h)(me,m==null?void 0:m.length,m)||{},position:ne,parentKey:(0,S.h)(Ee,m==null?void 0:m.length,m),newRecordType:he,children:(0,v.jsx)(O.ZP,(0,d.Z)((0,d.Z)({type:"dashed",style:(0,d.Z)({display:"block",margin:"10px 0",width:"100%"},D),icon:(0,v.jsx)(de.Z,{})},Pe),{},{children:fe||$.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[N,Z,m==null?void 0:m.length]),ge=(0,a.useMemo)(function(){return G?ue?{components:{header:{wrapper:function(i){var r,o=i.className,l=i.children;return(0,v.jsxs)("thead",{className:o,children:[l,(0,v.jsxs)("tr",{style:{position:"relative"},children:[(0,v.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:G}),(0,v.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(r=y.columns)===null||r===void 0?void 0:r.length,children:G})]})]})}}}}:{tableViewRender:function(i,r){var o,l;return(0,v.jsxs)(v.Fragment,{children:[(o=(l=e.tableViewRender)===null||l===void 0?void 0:l.call(e,i,r))!==null&&o!==void 0?o:r,G]})}}:{}},[ue,G]),c=(0,d.Z)({},e.editable),s=(0,j.J)(function(n,i){var r,o,l;if((r=e.editable)===null||r===void 0||(o=r.onValuesChange)===null||o===void 0||o.call(r,n,i),(l=e.onValuesChange)===null||l===void 0||l.call(e,i,n),e.controlled){var f;e==null||(f=e.onChange)===null||f===void 0||f.call(e,i)}});return(e!=null&&e.onValuesChange||(w=e.editable)!==null&&w!==void 0&&w.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(c.onValuesChange=s),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(U.Provider,{value:z,children:(0,v.jsx)(R.Z,(0,d.Z)((0,d.Z)((0,d.Z)({search:!1,options:!1,pagination:!1,rowKey:B,revalidateOnFocus:!1},y),ge),{},{tableLayout:"fixed",actionRef:z,onChange:V,editable:(0,d.Z)((0,d.Z)({},c),{},{formProps:(0,d.Z)({formRef:P},c.formProps)}),dataSource:m,onDataSourceChange:function(i){if(ve(i),e.name&&ne==="top"){var r,o=(0,h.Z)({},[e.name].flat(1).filter(Boolean),i);(r=P.current)===null||r===void 0||r.setFieldsValue(o)}}}))}),e.name?(0,v.jsx)(W.Z,{name:[e.name],children:function(i){var r,o;if(!p.current)return p.current=m,null;var l=(0,C.Z)(i,[e.name].flat(1)),f=l==null?void 0:l.find(function(_,M){var L;return!(0,Q.A)(_,(L=p.current)===null||L===void 0?void 0:L[M])});return p.current=m,f&&(e==null||(r=e.editable)===null||r===void 0||(o=r.onValuesChange)===null||o===void 0||o.call(r,f,l)),null}}):null]})}function T(e){var x=H.ZP.useFormInstance();return e.name?(0,v.jsx)(oe.Z.Item,(0,d.Z)((0,d.Z)({style:{maxWidth:"100%"},shouldUpdate:function($,V){var Z=[e.name].flat(1);try{return JSON.stringify((0,C.Z)($,Z))!==JSON.stringify((0,C.Z)(V,Z))}catch(X){return!0}}},e==null?void 0:e.formItemProps),{},{name:e.name,children:(0,v.jsx)(F,(0,d.Z)((0,d.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},e),{},{editable:(0,d.Z)((0,d.Z)({},e.editable),{},{form:x})}))})):(0,v.jsx)(F,(0,d.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},e))}T.RecordCreator=b,te.Z=T},52538:function(De,te,t){t.r(te);var re=t(39346),E=t.n(re),J=t(2927),ae=t.n(J),ie=t(43953),d=t.n(ie),de=t(91184),W=t.n(de),H=t(9083),g=t.n(H),j=t(34892),le=t(62067),S=t(16879),Q=t(75092),O=t(38497),oe=t(72049),Y=t(17746),C=t(47627),h=t(7160),a=t(79853),R=t(57581),v=t(76856),k=t(73819),u=t(96469),U=function(){var F=(0,O.useState)(!0),T=g()(F,2),e=T[0],x=T[1],w=(0,O.useState)(!0),$=g()(w,2),V=$[0],Z=$[1],X=(0,O.useState)(!1),N=g()(X,2),B=N[0],se=N[1],_e=(0,O.useState)(!1),q=g()(_e,2),ee=q[0],y=q[1],p=(0,O.useState)(0),z=g()(p,2),P=z[0],Ce=z[1],A=(0,O.useRef)(),m=(0,O.useState)([]),ve=g()(m,2),I=ve[0],ce=ve[1],K=(0,O.useState)({show:!1,formData:{code:"",name:""}}),me=g()(K,2),ne=me[0],fe=me[1],he=(0,O.useRef)(),Ee=(0,k.useModel)("@@initialState"),D=Ee.initialState,Pe=Ee.setInitialState,ue=(0,O.useRef)(),G=function(){fe({show:!1,formData:{code:"",name:""}})},ge=function(){var c=W()(d()().mark(function s(){var n,i,r,o,l;return d()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return i=(n=he.current)===null||n===void 0?void 0:n.getFieldsValue(),console.log("333",i),_.next=4,j.d.n.updateRole(i.objectId||"",{data:i});case 4:r=_.sent,o=r.objectId,o?(oe.ZP.success(o?"\u66F4\u65B0\u6210\u529F\uFF01":"\u6DFB\u52A0\u6210\u529F\uFF01"),G(),(l=ue.current)===null||l===void 0||l.reload()):oe.ZP.warning("\u64CD\u4F5C\u5931\u8D25");case 7:case"end":return _.stop()}},s)}));return function(){return c.apply(this,arguments)}}();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h1",{className:"red",children:"redredred"}),(0,u.jsxs)(Y.Z,{size:[10,10],wrap:!0,children:[(0,u.jsxs)(C.ZP.Group,{buttonStyle:"solid",optionType:"button",value:e,onChange:function(s){var n=s.target;return x(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"\u5C55\u793A proTableSearch"}),(0,u.jsx)(C.ZP,{value:!1,children:"\u4E0D\u5C55\u793A proTableSearch"})]}),(0,u.jsxs)(C.ZP.Group,{optionType:"button",value:V,onChange:function(s){var n=s.target;return Z(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"\u5C55\u793A toolBar"}),(0,u.jsx)(C.ZP,{value:!1,children:"\u4E0D\u5C55\u793A toolBar"})]}),(0,u.jsxs)(C.ZP.Group,{optionType:"button",value:B,onChange:function(s){var n=s.target;return se(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"cardBorderedSearch true"}),(0,u.jsx)(C.ZP,{value:!1,children:"cardBorderedSearch false"})]}),(0,u.jsxs)(C.ZP.Group,{optionType:"button",value:ee,onChange:function(s){var n=s.target;return y(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"\u5C55\u793A\u8FB9\u6846"}),(0,u.jsx)(C.ZP,{value:!1,children:"\u4E0D\u5C55\u793A\u8FB9\u6846"})]}),(0,u.jsx)(h.Z,{addonBefore:"\u67E5\u8BE2\u7684debounceTime",value:P,step:1e3,onChange:function(s){return Ce(s||0)}})]}),(0,u.jsx)(le.Z,{actionRef:ue,recordCreatorProps:{record:function(){return{name:"",code:"",id:Math.random()}}},search:e?{optionRender:function(s,n,i){return[].concat(ae()(i),[(0,u.jsx)(a.ZP,{onClick:function(){fe(E()(E()({},ne),{},{show:!0}))},children:"\u65B0\u589E\u89D2\u8272"}),(0,u.jsxs)(a.ZP,{onClick:function(){Pe(E()(E()({},D),{},{menuRenderFlag:!(D!=null&&D.menuRenderFlag)}))},children:["\u4FA7\u8FB9\u83DC\u5355",D!=null&&D.menuRenderFlag?"\u663E\u793A":"\u9690\u85CF"]}),(0,u.jsxs)(a.ZP,{onClick:function(){Pe(E()(E()({},D),{},{topFlag:!(D!=null&&D.topFlag)}))},children:["\u5934\u90E8",D!=null&&D.topFlag?"\u663E\u793A":"\u9690\u85CF"]})])}}:!1,headerTitle:"\u5DE6\u4E0A\u89D2\u7684\u6807\u9898",tooltip:"\u5DE6\u4E0A\u89D2\u7684\u6807\u9898\u7684\u4E00\u4E9B\u89E3\u91CA",pagination:{showQuickJumper:!0,pageSize:5,pageSizeOptions:[5,10,15,30,100],onChange:function(s,n){console.log("paination>>>",s,n)},showSizeChanger:{},onShowSizeChange:function(s,n){console.log("onShowSizeChange>>>",s,n)}},bordered:ee,cardBordered:{table:B},loading:{tip:123},virtual:!0,debounceTime:P,rowSelection:{columnWidth:20},editable:{type:"multiple",editableKeys:I,onSave:function(){var c=W()(d()().mark(function n(i,r,o){var l;return d()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:console.log(i,r,o),l=JSON.parse(JSON.stringify(r)),delete l.createdAt,delete l.updatedAt,delete l.objectId,delete l.index,delete l.id,j.d.n.updateRole(o.createdAt&&o.objectId||"",{data:l}).then(function(M){var L;(L=ue.current)===null||L===void 0||L.reload()});case 8:case"end":return _.stop()}},n)}));function s(n,i,r){return c.apply(this,arguments)}return s}(),onChange:ce},formRef:A,toolBarRender:V?function(){return[(0,u.jsx)(a.ZP,{onClick:function(){if(console.log(A.current),A.current){var s=A.current.getFieldsValue();Object.keys(s).length>0&&(console.log(A.current),j.d.n.updateRole("",E()({},A.current.getFieldsValue())),R.ZP.success({message:"\u65B0\u589E\u6210\u529F"}),A.current.resetFields(),A.current.submit())}},children:"\u63D0\u4EA4"},"submit")]}:!1,rowKey:"id",options:!1,type:"descriptions",cardProps:{title:"\u4E1A\u52A1\u5B9A\u5236",bordered:!0,collapsible:!0},tableAlertRender:function(s){return console.log("rest",s),(0,u.jsx)("div",{children:"\u60A8\u5DF2\u7ECF\u5F00\u59CB\u9009\u62E9\u6570\u636E"})},tableAlertOptionRender:function(s){return(0,u.jsx)(a.ZP,{onClick:function(){return s.onCleanSelected()},children:"\u60F3\u53D6\u6D88\u9009\u62E9"})},dateFormatter:"string",columns:[{key:"code",title:"code",width:160,dataIndex:"code"},{key:"name",editable:function(){return!0},title:"\u89D2\u8272\u522B\u540D",dataIndex:"name",width:160},{key:"menuAccess",editable:function(){return!0},title:"\u83DC\u5355\u6743\u9650",dataIndex:"menuAccess",width:200,ellipsis:!0},{title:"\u64CD\u4F5C",valueType:"option",width:150,render:function(s,n,i,r){return[n.objectId?(0,u.jsx)("a",{onClick:function(){var l;console.log(r),n.id&&(r==null||(l=r.startEditable)===null||l===void 0||l.call(r,n.id))},children:"\u7F16\u8F91"},"editable"):null,(0,u.jsx)(le.Z.RecordCreator,{record:{name:n.name||"",code:n.code||"",menuAccess:n.menuAccess||"",id:(Math.random()*1e6).toFixed(0)},children:(0,u.jsx)("a",{children:"\u590D\u5236\u6B64\u9879\u5230\u672B\u5C3E"})},"copy")]}}],request:function(){var c=W()(d()().mark(function s(n,i,r){var o,l;return d()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return console.log("********",n,i,r),_.next=3,j.d.n.getRoles("",{params:{order:"createdAt",where:E()(E()({},n.code?{code:{$in:[n.code]}}:{}),n.name?{name:{$regex:n.name,$options:"i"}}:{})}});case 3:return o=_.sent,l=o.results.map(function(M){return E()(E()({},M),{},{id:M.objectId})}),console.log("resList",l),_.abrupt("return",{data:l,success:!0,total:o.results.length});case 7:case"end":return _.stop()}},s)}));return function(s,n,i){return c.apply(this,arguments)}}()}),(0,u.jsx)(v.Z,{title:ne.formData.objectId?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272",open:ne.show,onOk:function(){ge()},onCancel:function(){G()},children:(0,u.jsxs)(S.A,{formRef:he,isKeyPressSubmit:!0,submitter:!1,onFinish:W()(d()().mark(function c(){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:ge();case 1:case"end":return n.stop()}},c)})),children:[(0,u.jsx)(Q.Z,{name:"name",rules:[{required:!0,message:"name \u4E0D\u80FD\u4E3A\u7A7A"}],required:!0,label:"name"}),(0,u.jsx)(Q.Z,{name:"code",rules:[{required:!0,message:"code \u4E0D\u80FD\u4E3A\u7A7A"}],required:!0,label:"code"}),(0,u.jsx)(Q.Z,{name:"menuAccess",label:"menuAccess"})]})})]})};te.default=U}}]);
