"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[463],{80165:function(De,te,t){var re=t(7749),E=t(82574),J=t(35569),ae=t(77511),ie=t(1193),d=t(43015),de=t(61060),W=t(38497),H=t(39569),g=t(96469),Z=["fieldProps","proFieldProps"],oe=["fieldProps","proFieldProps"],B="text",Q=function(h){var a=h.fieldProps,R=h.proFieldProps,v=(0,J.Z)(h,Z);return(0,g.jsx)(H.Z,(0,E.Z)({valueType:B,fieldProps:a,filedConfig:{valueType:B},proFieldProps:R},v))},O=function(h){var a=(0,ae.Z)(h.open||!1,{value:h.open,onChange:h.onOpenChange}),R=(0,re.Z)(a,2),v=R[0],k=R[1];return(0,g.jsx)(ie.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(U){var b,F=U.getFieldValue(h.name||[]);return(0,g.jsx)(d.Z,(0,E.Z)((0,E.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return k(e)},content:(0,g.jsxs)("div",{style:{padding:"4px 0"},children:[(b=h.statusRender)===null||b===void 0?void 0:b.call(h,F),h.strengthText?(0,g.jsx)("div",{style:{marginTop:10},children:(0,g.jsx)("span",{children:h.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},h.popoverProps),{},{open:v,children:h.children}))}})},le=function(h){var a=h.fieldProps,R=h.proFieldProps,v=(0,J.Z)(h,oe),k=(0,W.useState)(!1),u=(0,re.Z)(k,2),U=u[0],b=u[1];return a!=null&&a.statusRender&&v.name?(0,g.jsx)(O,{name:v.name,statusRender:a==null?void 0:a.statusRender,popoverProps:a==null?void 0:a.popoverProps,strengthText:a==null?void 0:a.strengthText,open:U,onOpenChange:b,children:(0,g.jsx)("div",{children:(0,g.jsx)(H.Z,(0,E.Z)({valueType:"password",fieldProps:(0,E.Z)((0,E.Z)({},(0,de.Z)(a,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(T){var e;a==null||(e=a.onBlur)===null||e===void 0||e.call(a,T),b(!1)},onClick:function(T){var e;a==null||(e=a.onClick)===null||e===void 0||e.call(a,T),b(!0)}}),proFieldProps:R,filedConfig:{valueType:B}},v))})}):(0,g.jsx)(H.Z,(0,E.Z)({valueType:"password",fieldProps:a,proFieldProps:R,filedConfig:{valueType:B}},v))},Y=Q;Y.Password=le,Y.displayName="ProFormComponent",te.Z=Y},67733:function(De,te,t){var re=t(43599),E=t(7749),J=t(35569),ae=t(40173),ie=t(53648),d=t(82574),de=t(30606),W=t(61343),H=t(90537),g=t(71398),Z=t(88100),oe=t(85563),B=t(42028),Q=t(61463),O=t(45401),le=t(1193),Y=t(77511),C=t(96619),h=t(3494),a=t(38497),R=t(3389),v=t(96469),k=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],u=["record","position","creatorButtonText","newRecordType","parentKey","style"],U=a.createContext(void 0);function b(e){var p=e.children,w=e.record,$=e.position,V=e.newRecordType,A=e.parentKey,X=(0,a.useContext)(U);return a.cloneElement(p,(0,d.Z)((0,d.Z)({},p.props),{},{onClick:function(){var N=(0,ie.Z)((0,ae.Z)().mark(function _e(se){var q,ee,S,y;return(0,ae.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(q=(ee=p.props).onClick)===null||q===void 0?void 0:q.call(ee,se);case 2:if(y=P.sent,y!==!1){P.next=5;break}return P.abrupt("return");case 5:X==null||(S=X.current)===null||S===void 0||S.addEditRecord(w,{position:$,newRecordType:V,parentKey:A});case 6:case"end":return P.stop()}},_e)}));function x(_e){return N.apply(this,arguments)}return x}()}))}function F(e){var p,w,$=(0,g.YB)(),V=e.onTableChange,A=e.maxLength,X=e.formItemProps,N=e.recordCreatorProps,x=e.rowKey,_e=e.controlled,se=e.defaultValue,q=e.onChange,ee=e.editableFormRef,S=(0,J.Z)(e,k),y=(0,a.useRef)(void 0),z=(0,a.useRef)(),P=(0,a.useRef)();(0,a.useImperativeHandle)(S.actionRef,function(){return z.current},[z.current]);var Ce=(0,Y.Z)(function(){return e.value||se||[]},{value:e.value,onChange:e.onChange}),j=(0,E.Z)(Ce,2),m=j[0],ve=j[1],I=a.useMemo(function(){return typeof x=="function"?x:function(n,i){return n[x]||i}},[x]),ce=(0,Z.J)(function(n){if(typeof n=="number"&&!e.name){if(n>=m.length)return n;var i=m&&m[n];return I==null?void 0:I(i,n)}if((typeof n=="string"||n>=m.length)&&e.name){var r=m.findIndex(function(l,o){var f;return(I==null||(f=I(l,o))===null||f===void 0?void 0:f.toString())===(n==null?void 0:n.toString())});if(r!==-1)return r}return n});(0,a.useImperativeHandle)(ee,function(){var n=function(l){var o,f;if(l==null)throw new Error("rowIndex is required");var s=ce(l),M=[e.name,(o=s==null?void 0:s.toString())!==null&&o!==void 0?o:""].flat(1).filter(Boolean);return(f=P.current)===null||f===void 0?void 0:f.getFieldValue(M)},i=function(){var l,o=[e.name].flat(1).filter(Boolean);if(Array.isArray(o)&&o.length===0){var f,s=(f=P.current)===null||f===void 0?void 0:f.getFieldsValue();return Array.isArray(s)?s:Object.keys(s).map(function(M){return s[M]})}return(l=P.current)===null||l===void 0?void 0:l.getFieldValue(o)};return(0,d.Z)((0,d.Z)({},P.current),{},{getRowData:n,getRowsData:i,setRowData:function(l,o){var f,s;if(l==null)throw new Error("rowIndex is required");var M=ce(l),L=[e.name,(f=M==null?void 0:M.toString())!==null&&f!==void 0?f:""].flat(1).filter(Boolean),Oe=Object.assign({},(0,d.Z)((0,d.Z)({},n(l)),o||{})),Me=(0,h.Z)({},L,Oe);return(s=P.current)===null||s===void 0||s.setFieldsValue(Me),!0}})},[ce,e.name,P.current]),(0,a.useEffect)(function(){e.controlled&&(m||[]).forEach(function(n,i){var r;(r=P.current)===null||r===void 0||r.setFieldsValue((0,re.Z)({},"".concat(I(n,i)),n))},{})},[(0,oe.ZP)(m),e.controlled]),(0,a.useEffect)(function(){if(e.name){var n;P.current=e==null||(n=e.editable)===null||n===void 0?void 0:n.form}},[(p=e.editable)===null||p===void 0?void 0:p.form,e.name]);var K=N||{},me=K.record,ne=K.position,fe=K.creatorButtonText,he=K.newRecordType,Ee=K.parentKey,D=K.style,Pe=(0,J.Z)(K,u),ue=ne==="top",G=(0,a.useMemo)(function(){return typeof A=="number"&&A<=(m==null?void 0:m.length)?!1:N!==!1&&(0,v.jsx)(b,{record:(0,B.h)(me,m==null?void 0:m.length,m)||{},position:ne,parentKey:(0,B.h)(Ee,m==null?void 0:m.length,m),newRecordType:he,children:(0,v.jsx)(O.ZP,(0,d.Z)((0,d.Z)({type:"dashed",style:(0,d.Z)({display:"block",margin:"10px 0",width:"100%"},D),icon:(0,v.jsx)(de.Z,{})},Pe),{},{children:fe||$.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[N,A,m==null?void 0:m.length]),ge=(0,a.useMemo)(function(){return G?ue?{components:{header:{wrapper:function(i){var r,l=i.className,o=i.children;return(0,v.jsxs)("thead",{className:l,children:[o,(0,v.jsxs)("tr",{style:{position:"relative"},children:[(0,v.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:G}),(0,v.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(r=S.columns)===null||r===void 0?void 0:r.length,children:G})]})]})}}}}:{tableViewRender:function(i,r){var l,o;return(0,v.jsxs)(v.Fragment,{children:[(l=(o=e.tableViewRender)===null||o===void 0?void 0:o.call(e,i,r))!==null&&l!==void 0?l:r,G]})}}:{}},[ue,G]),c=(0,d.Z)({},e.editable),_=(0,Z.J)(function(n,i){var r,l,o;if((r=e.editable)===null||r===void 0||(l=r.onValuesChange)===null||l===void 0||l.call(r,n,i),(o=e.onValuesChange)===null||o===void 0||o.call(e,i,n),e.controlled){var f;e==null||(f=e.onChange)===null||f===void 0||f.call(e,i)}});return(e!=null&&e.onValuesChange||(w=e.editable)!==null&&w!==void 0&&w.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(c.onValuesChange=_),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(U.Provider,{value:z,children:(0,v.jsx)(R.Z,(0,d.Z)((0,d.Z)((0,d.Z)({search:!1,options:!1,pagination:!1,rowKey:x,revalidateOnFocus:!1},S),ge),{},{tableLayout:"fixed",actionRef:z,onChange:V,editable:(0,d.Z)((0,d.Z)({},c),{},{formProps:(0,d.Z)({formRef:P},c.formProps)}),dataSource:m,onDataSourceChange:function(i){if(ve(i),e.name&&ne==="top"){var r,l=(0,h.Z)({},[e.name].flat(1).filter(Boolean),i);(r=P.current)===null||r===void 0||r.setFieldsValue(l)}}}))}),e.name?(0,v.jsx)(W.Z,{name:[e.name],children:function(i){var r,l;if(!y.current)return y.current=m,null;var o=(0,C.Z)(i,[e.name].flat(1)),f=o==null?void 0:o.find(function(s,M){var L;return!(0,Q.A)(s,(L=y.current)===null||L===void 0?void 0:L[M])});return y.current=m,f&&(e==null||(r=e.editable)===null||r===void 0||(l=r.onValuesChange)===null||l===void 0||l.call(r,f,o)),null}}):null]})}function T(e){var p=H.ZP.useFormInstance();return e.name?(0,v.jsx)(le.Z.Item,(0,d.Z)((0,d.Z)({style:{maxWidth:"100%"},shouldUpdate:function($,V){var A=[e.name].flat(1);try{return JSON.stringify((0,C.Z)($,A))!==JSON.stringify((0,C.Z)(V,A))}catch(X){return!0}}},e==null?void 0:e.formItemProps),{},{name:e.name,children:(0,v.jsx)(F,(0,d.Z)((0,d.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},e),{},{editable:(0,d.Z)((0,d.Z)({},e.editable),{},{form:p})}))})):(0,v.jsx)(F,(0,d.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},e))}T.RecordCreator=b,te.Z=T},64093:function(De,te,t){t.r(te);var re=t(39346),E=t.n(re),J=t(2927),ae=t.n(J),ie=t(43953),d=t.n(ie),de=t(91184),W=t.n(de),H=t(9083),g=t.n(H),Z=t(4701),oe=t(67733),B=t(70895),Q=t(80165),O=t(38497),le=t(37823),Y=t(98958),C=t(37719),h=t(670),a=t(45401),R=t(45839),v=t(10145),k=t(39495),u=t(96469),U=function(){var F=(0,O.useState)(!0),T=g()(F,2),e=T[0],p=T[1],w=(0,O.useState)(!0),$=g()(w,2),V=$[0],A=$[1],X=(0,O.useState)(!1),N=g()(X,2),x=N[0],_e=N[1],se=(0,O.useState)(!1),q=g()(se,2),ee=q[0],S=q[1],y=(0,O.useState)(0),z=g()(y,2),P=z[0],Ce=z[1],j=(0,O.useRef)(),m=(0,O.useState)([]),ve=g()(m,2),I=ve[0],ce=ve[1],K=(0,O.useState)({show:!1,formData:{code:"",name:""}}),me=g()(K,2),ne=me[0],fe=me[1],he=(0,O.useRef)(),Ee=(0,k.useModel)("@@initialState"),D=Ee.initialState,Pe=Ee.setInitialState,ue=(0,O.useRef)(),G=function(){fe({show:!1,formData:{code:"",name:""}})},ge=function(){var c=W()(d()().mark(function _(){var n,i,r,l,o;return d()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=(n=he.current)===null||n===void 0?void 0:n.getFieldsValue(),console.log("333",i),s.next=4,Z.d.n.updateRole(i.objectId||"",{data:i});case 4:r=s.sent,l=r.objectId,l?(le.ZP.success(l?"\u66F4\u65B0\u6210\u529F\uFF01":"\u6DFB\u52A0\u6210\u529F\uFF01"),G(),(o=ue.current)===null||o===void 0||o.reload()):le.ZP.warning("\u64CD\u4F5C\u5931\u8D25");case 7:case"end":return s.stop()}},_)}));return function(){return c.apply(this,arguments)}}();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h1",{className:"red",children:"redredred"}),(0,u.jsxs)(Y.Z,{size:[10,10],wrap:!0,children:[(0,u.jsxs)(C.ZP.Group,{buttonStyle:"solid",optionType:"button",value:e,onChange:function(_){var n=_.target;return p(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"\u5C55\u793A proTableSearch"}),(0,u.jsx)(C.ZP,{value:!1,children:"\u4E0D\u5C55\u793A proTableSearch"})]}),(0,u.jsxs)(C.ZP.Group,{optionType:"button",value:V,onChange:function(_){var n=_.target;return A(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"\u5C55\u793A toolBar"}),(0,u.jsx)(C.ZP,{value:!1,children:"\u4E0D\u5C55\u793A toolBar"})]}),(0,u.jsxs)(C.ZP.Group,{optionType:"button",value:x,onChange:function(_){var n=_.target;return _e(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"cardBorderedSearch true"}),(0,u.jsx)(C.ZP,{value:!1,children:"cardBorderedSearch false"})]}),(0,u.jsxs)(C.ZP.Group,{optionType:"button",value:ee,onChange:function(_){var n=_.target;return S(n.value||!1)},children:[(0,u.jsx)(C.ZP,{value:!0,children:"\u5C55\u793A\u8FB9\u6846"}),(0,u.jsx)(C.ZP,{value:!1,children:"\u4E0D\u5C55\u793A\u8FB9\u6846"})]}),(0,u.jsx)(h.Z,{addonBefore:"\u67E5\u8BE2\u7684debounceTime",value:P,step:1e3,onChange:function(_){return Ce(_||0)}})]}),(0,u.jsx)(oe.Z,{actionRef:ue,recordCreatorProps:{record:function(){return{name:"",code:"",id:Math.random()}}},search:e?{optionRender:function(_,n,i){return[].concat(ae()(i),[(0,u.jsx)(a.ZP,{onClick:function(){fe(E()(E()({},ne),{},{show:!0}))},children:"\u65B0\u589E\u89D2\u8272"}),(0,u.jsxs)(a.ZP,{onClick:function(){Pe(E()(E()({},D),{},{menuRenderFlag:!(D!=null&&D.menuRenderFlag)}))},children:["\u4FA7\u8FB9\u83DC\u5355",D!=null&&D.menuRenderFlag?"\u663E\u793A":"\u9690\u85CF"]}),(0,u.jsxs)(a.ZP,{onClick:function(){Pe(E()(E()({},D),{},{topFlag:!(D!=null&&D.topFlag)}))},children:["\u5934\u90E8",D!=null&&D.topFlag?"\u663E\u793A":"\u9690\u85CF"]})])}}:!1,headerTitle:"\u5DE6\u4E0A\u89D2\u7684\u6807\u9898",tooltip:"\u5DE6\u4E0A\u89D2\u7684\u6807\u9898\u7684\u4E00\u4E9B\u89E3\u91CA",pagination:{showQuickJumper:!0,pageSize:5,pageSizeOptions:[5,10,15,30,100],onChange:function(_,n){console.log("paination>>>",_,n)},showSizeChanger:{},onShowSizeChange:function(_,n){console.log("onShowSizeChange>>>",_,n)}},bordered:ee,cardBordered:{table:x},loading:{tip:123},virtual:!0,debounceTime:P,rowSelection:{columnWidth:20},editable:{type:"multiple",editableKeys:I,onSave:function(){var c=W()(d()().mark(function n(i,r,l){var o;return d()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:console.log(i,r,l),o=JSON.parse(JSON.stringify(r)),delete o.createdAt,delete o.updatedAt,delete o.objectId,delete o.index,delete o.id,Z.d.n.updateRole(l.createdAt&&l.objectId||"",{data:o}).then(function(M){var L;(L=ue.current)===null||L===void 0||L.reload()});case 8:case"end":return s.stop()}},n)}));function _(n,i,r){return c.apply(this,arguments)}return _}(),onChange:ce},formRef:j,toolBarRender:V?function(){return[(0,u.jsx)(a.ZP,{onClick:function(){if(console.log(j.current),j.current){var _=j.current.getFieldsValue();Object.keys(_).length>0&&(console.log(j.current),Z.d.n.updateRole("",E()({},j.current.getFieldsValue())),R.ZP.success({message:"\u65B0\u589E\u6210\u529F"}),j.current.resetFields(),j.current.submit())}},children:"\u63D0\u4EA4"},"submit")]}:!1,rowKey:"id",options:!1,type:"descriptions",cardProps:{title:"\u4E1A\u52A1\u5B9A\u5236",bordered:!0,collapsible:!0},tableAlertRender:function(_){return console.log("rest",_),(0,u.jsx)("div",{children:"\u60A8\u5DF2\u7ECF\u5F00\u59CB\u9009\u62E9\u6570\u636E"})},tableAlertOptionRender:function(_){return(0,u.jsx)(a.ZP,{onClick:function(){return _.onCleanSelected()},children:"\u60F3\u53D6\u6D88\u9009\u62E9"})},dateFormatter:"string",columns:[{key:"code",title:"code",width:160,dataIndex:"code"},{key:"name",editable:function(){return!0},title:"\u89D2\u8272\u522B\u540D",dataIndex:"name",width:160},{key:"menuAccess",editable:function(){return!0},title:"\u83DC\u5355\u6743\u9650",dataIndex:"menuAccess",width:200,ellipsis:!0},{title:"\u64CD\u4F5C",valueType:"option",width:150,render:function(_,n,i,r){return[n.objectId?(0,u.jsx)("a",{onClick:function(){var o;console.log(r),n.id&&(r==null||(o=r.startEditable)===null||o===void 0||o.call(r,n.id))},children:"\u7F16\u8F91"},"editable"):null,(0,u.jsx)(oe.Z.RecordCreator,{record:{name:n.name||"",code:n.code||"",menuAccess:n.menuAccess||"",id:(Math.random()*1e6).toFixed(0)},children:(0,u.jsx)("a",{children:"\u590D\u5236\u6B64\u9879\u5230\u672B\u5C3E"})},"copy")]}}],request:function(){var c=W()(d()().mark(function _(n,i,r){var l,o;return d()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("********",n,i,r),s.next=3,Z.d.n.getRoles("",{params:{order:"createdAt",where:E()(E()({},n.code?{code:{$in:[n.code]}}:{}),n.name?{name:{$regex:n.name,$options:"i"}}:{})}});case 3:return l=s.sent,o=l.results.map(function(M){return E()(E()({},M),{},{id:M.objectId})}),console.log("resList",o),s.abrupt("return",{data:o,success:!0,total:l.results.length});case 7:case"end":return s.stop()}},_)}));return function(_,n,i){return c.apply(this,arguments)}}()}),(0,u.jsx)(v.Z,{title:ne.formData.objectId?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272",open:ne.show,onOk:function(){ge()},onCancel:function(){G()},children:(0,u.jsxs)(B.A,{formRef:he,isKeyPressSubmit:!0,submitter:!1,onFinish:W()(d()().mark(function c(){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:ge();case 1:case"end":return n.stop()}},c)})),children:[(0,u.jsx)(Q.Z,{name:"name",rules:[{required:!0,message:"name \u4E0D\u80FD\u4E3A\u7A7A"}],required:!0,label:"name"}),(0,u.jsx)(Q.Z,{name:"code",rules:[{required:!0,message:"code \u4E0D\u80FD\u4E3A\u7A7A"}],required:!0,label:"code"}),(0,u.jsx)(Q.Z,{name:"menuAccess",label:"menuAccess"})]})})]})};te.default=U}}]);
